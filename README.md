# 📨 Email Scheduler Server

매일 정해진 시간에 대규모 구독자에게 이메일을 자동 발송하는 Java 기반 스케줄러 서버입니다.  
스케줄링, 메시지 큐, 비동기 처리, 동시성 제어 등 백엔드 핵심 개념을 직접 구현하며  
**대량 이메일 발송 서비스**의 내부 동작 원리를 깊이 이해하는 것을 목표로 합니다.

---

## 프로젝트 선정 배경

평소 구독하던 뉴스레터 서비스가   
"정해진 시간에 엄청나게 많은 사용자에게 동시에" 메일을 발송하는 것이 신기했습니다.

- 이런 시스템은 어떤 구조로 동작할까?
- 메일은 어떤 방식으로 대량 발송될까?
- 한 번에 수십만 명에게 보내는데 서버는 멀쩡한 이유는 무엇일까?
- 메시지는 어떻게 관리되고 처리될까?

이 궁금증을 해결하기 위해 직접 설계하고 구현하며  
뉴스레터 발송 시스템의 내부 동작을 깊이 이해하는 것을 목표로 진행했습니다.

---

## 프로젝트 목표

### 1주차: 핵심 개념 이해

- 프로젝트 초기 설정 및 인프라 구성
- Spring `@Scheduled` 기반 스케줄러 동작 이해
- RabbitMQ & AMQP 기본 개념 학습
- Fanout 기반 Pub/Sub 실습

### 2주차: 실제 뉴스레터 서버 구축

- 뉴스레터 순차 발송 로직 구현
- 대량 구독자 발송 성능 측정  
  (1,000명 ➔ 10,000명 ➔ 100,000명)
- Paging 및 벌크 처리 기반 성능 개선
- 이메일 구독/구독취소 API 구현 (+ 유효성 검증)

---

## 전체 동작 흐름

이 시스템은 **구독 ➔ 발행 ➔ 전송**의 3단계 비동기 파이프라인으로 구성됩니다.

### 1단계: 구독 (API 서버)

- 사용자는 `REST API`를 통해 뉴스레터 구독 또는 구독 취소를 요청합니다.
- 서버는 이메일을 DB에 저장하거나 상태(활성/비활성)를 변경합니다.
- 이미 구독 중일 경우 중복 구독을 방지합니다.

### 2단계: 발행 (스케줄러 & RabbitMQ)

- 매일 오전 8시 스케줄러가 실행됩니다.
- 최근 발송된 뉴스레터를 기준으로 다음 발송 파일을 결정합니다.
- 메시지를 `RabbitMQ Fanout Exchange`에 발행(`Publish`)합니다.

### 3단계: 전송 (비동기 Consumer)

- `Consumer`는 `newsletter.queue`에서 메시지를 수신합니다.
- 활성 구독자를 페이징(`Paging`)하여 메모리 부담 없이 조회합니다.
- 각 페이지(10,000명 단위)별로 이메일을 배치 전송합니다.
- 발송 결과는 DB에 기록됩니다.

---

## 전체 구조 한 줄 요약

> "API로 구독 정보를 저장하고,   
> 스케줄러가 매일 뉴스레터를 읽어 RabbitMQ Fanout Exchange에 발행하면,   
> Consumer가 메시지를 받아 구독자를 Paging 단위로 나눠 대량 이메일을 배치 전송하는 구조"

---

## 기술 스택

- Language: `Java 21`
- Framework: `Spring Boot 3.5.7`
- Message Queue: `RabbitMQ`
- Database: `MySQL` + `JPA`
- Build Tool: `Gradle`

---

## 실행 방법

### 1) Docker 실행

```bash
cd infra
docker-compose up -d
```

### 2) 컨테이너 상태 확인

```bash
docker ps
```

### 정상 출력 예시

```text
CONTAINER ID   IMAGE                  PORTS
a1b2c3d4e5f6   rabbitmq:3-management  0.0.0.0:15672->15672/tcp
b2c3d4e5f6a7   mysql:8.0              0.0.0.0:3306->3306/tcp
```

### 3) 중지

```bash
docker-compose down
```

---

## 배운점

- `Fanout Exchange` 기반 `Pub/Sub` 메시지 흐름
- 뉴스레터 발송 시스템의 전체적인 아키텍처 구성
- 구독자 3명 ➔ 10만 명 증가에 대응하는 구조적/성능적 개선
- 이메일 구독/구독취소 API + 유효성 검증 처리
- 비동기 처리, 배치 처리, Paging 기반 대량 처리의 필요성과 구현 방법

2주 동안 RabbitMQ, 스케줄러, 비동기 시스템에 대해  
단순 개념이 아닌 실제 구현 가능한 수준의 이해를 목표로 꾸준히 개선했습니다.

--- 

## 블로그 기록

프로젝트 진행 중 배운 내용을 자세히 기록했습니다.

- [블로그 링크 - Open Mission 기록 모음](https://sihyun10.github.io/categories/open-mission/)

---

## 참고

본 프로젝트는 우아한테크코스 프리코스 "오픈미션 : 프리코스 챌린지"를 위해 진행되었습니다.
